uri: 0.0.0.0:7070 # uri for ui
interval: 10s # control cycle interval

# sponsor token enables optional features (request at https://cloud.evcc.io)
# sponsortoken:

# log settings
log: debug
levels:
  core: debug
  lp-1: debug
  lp-2: debug

# meter definitions
# name can be freely chosen and is used as reference when assigning meters to site and loadpoints
# for examples see https://github.com/evcc-io/config#meters
meters:
- name: gridSim
  type: sim-meter
  usage: grid
- name: pvSim
  type: sim-meter
  power: 500 # [W] produces power: positive sign
  usage: pv
- name: batterySim
  type: sim-meter
  usage: battery
  capacity: 1 # [kWh]
  powerLimit: 5000 # [W]
  soc: 0 # [%]
- name: homeSim
  type: sim-meter
  usage: home
  power: 0 # [W] consumes power: negative sign

# charger definitions
# name can be freely chosen and is used as reference when assigning charger to vehicle
# for examples see https://github.com/evcc-io/config#chargers
chargers:
- name: chargerSim
  type: sim-charger
  status: A # initial charger status see api.ChargeStatus
  switch1p3p: switch1p3pSim # name of the 1p3p switch to use

# switch1p3p definitions
# name can be freely chosen and is used as reference when assigning a switch to a loadpoint
switches1p3p:
- name: switch1p3pSim
  type: sim-switch1p3p
  phases: 1 # initial phases setting

# vehicle definitions
# name can be freely chosen and is used as reference when assigning vehicle to loadpoint
# for examples see https://github.com/evcc-io/config#vehicles
vehicles:
- name: vehicleSim
  type: sim-vehicle
  capacity: 58.0 #[kWh]
  powerLimit: 22000 # [W]
  bidirectional: false
  soc: 72 #[%]
  title: mySimCar
  identifiers:
    - Identifier1
    - Identifier2

# site describes the EVU connection, PV and home battery
site:
  title: Home # display name for UI
  meters:
    grid: gridSim # grid meter
    pvs:
    - pvSim # list of pv inverters/ meters
    battery: batterySim # battery meter
  prioritySoC: # give home battery priority up to this soc (empty to disable)
  bufferSoC: # ignore home battery discharge above soc (empty to disable)
  simulators:
    - simSimulator

simulators:
  - name: simSimulator
    type: simulator
    active: true
    program:
    - cmd: sleep
      value: 10s
    - cmd: setGui
      attribute: mode
      value: off
    - cmd: connect
      object: chargerSim
      attribute: vehicle
      value: vehicleSim
    - cmd: sleep
      value: 30s
    - cmd: setGui
      attribute: mode
      value: now
    - cmd: sleep
      value: 60s
    - cmd: set
      object: switch1p3pSim
      attribute: lockPhases
      value: 2
    - cmd: setGui
      attribute: mode
      value: minpv
    - cmd: expect
      object: switch1p3pSim
      attribute: phases
      value: 2
      timeout: 60s
    - cmd: set
      object: switch1p3pSim
      attribute: unlockPhases
    - cmd: sleep
      value: 20s
    - cmd: setGui
      attribute: mode
      value: now
    - cmd: sleep
      value: 30s
    - cmd: setGui
      attribute: mode
      value: minpv
    - cmd: sleep
      value: 30s
    - cmd: setGui
      attribute: mode
      value: now
    - cmd: expect
      object: switch1p3pSim
      attribute: phases
      value: 3
      timeout: 60s

# loadpoint describes the charger, charge meter and connected vehicle
loadpoints:
- title: Carport # display name for UI
  charger: chargerSim # charger
  switch1p3p: switch1p3pSim
  #meters:
  #  charge: charge # charge meter
  vehicle: vehicleSim
  # vehicles: # use if multiple vehicles allowed to charge on this loadpoint
  # - ID.3
  # - e-Up
  mode: pv
  resetOnDisconnect: true # set defaults when vehicle disconnects
  soc:
    # polling defines usage of the vehicle APIs
    # Modifying the default settings it NOT recommended. It MAY deplete your vehicle's battery
    # or lead to vehicle manufacturer banning you from API use. USE AT YOUR OWN RISK.
    poll:
      # poll mode defines under which condition the vehicle API is called:
      #   charging: update vehicle ONLY when charging (this is the recommended default)
      #   connected: update vehicle when connected (not only charging), interval defines how often
      #   always: always update vehicle regardless of connection state, interval defines how often (only supported for single vehicle)
      mode: charging
      # poll interval defines how often the vehicle API may be polled if NOT charging
      interval: 60m
    min: 0 # immediately charge to 0% regardless of mode unless "off" (disabled)
    target: 100 # always charge to 100%
    estimate: true # set true to interpolate between api updates
  phases: 3 # ev phases (default 3)
  enable: # pv mode enable behavior
    delay: 10s # threshold must be exceeded for this long
    threshold: 0 # grid power threshold (in Watts, negative=export). If zero, export must exceed minimum charge power to enable
  disable: # pv mode disable behavior
    delay:  10s # threshold must be exceeded for this long
    threshold: 200 # maximum import power (W)
  guardDuration: 10s # switch charger contactor not more often than this (default 10m)
  minCurrent: 6 # minimum charge current (default 6A)
  maxCurrent: 20 # maximum charge current (default 16A)

# tariffs are the fixed or variable tariffs
# cheap can be used to define a tariff rate considered cheap enough for charging
tariffs:
  grid:
    # # either
    # type: tibber
    # cheap: 20 # ct/kWh
    # token: "476c477d8a039529478ebd690d35ddd80e3308ffc49b59c65b142321aee963a4" # access token
    # homeid: "cc83e83e-8cbf-4595-9bf7-c3cf192f7d9c" # optional if multiple homes associated to account

    # # or
    # type: awattar
    # cheap: 20 # ct/kWh
    # region: de # optional, choose at for Austria

# mqtt message broker
mqtt:
  # broker: localhost:1883
  # topic: evcc # root topic for publishing, set empty to disable
  # user:
  # password:

# influx database
influx:
  # url: http://localhost:8086
  # database: evcc
  # user:
  # password:

# eebus credentials
eebus:
  # uri: # :4712
  # interfaces: # limit eebus to specific network interfaces
  # - en0
  # certificate: # local signed certificate, required, can be generated via `evcc eebus-cert`
  #   public: # public key
  #   private: # private key

# push messages
messaging:
  events:
    start: # charge start event
      title: Charge started
      msg: Started charging in "${mode}" mode
    stop: # charge stop event
      title: Charge finished
      msg: Finished charging ${chargedEnergy:%.1fk}kWh in ${chargeDuration}.
    connect: # vehicle connect event
      title: Car connected
      msg: "Car connected at ${pvPower:%.1fk}kW PV"
    disconnect: # vehicle connected event
      title: Car disconnected
      msg: Car disconnected after ${connectedDuration}
  services:
  # - type: pushover
  #   app: # app id
  #   recipients:
  #   - # list of recipient ids
  # - type: telegram
  #   token: # bot id
  #   chats:
  #   - # list of chat ids
  # - type: email
  #   uri: smtp://<user>:<password>@<host>:<port>/?fromAddress=<from>&toAddresses=<to>
